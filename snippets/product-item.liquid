<div class="product-item">
  <a
    :href="url || product.url || productUrl"
    :title="product.title"
    class="space-y-3">
    {%- comment -%}
      .product-image class used for forced aspect ratio settings
    {%- endcomment -%}
    <div class="product-item__image-wrapper">
      <div 
        class="product-item__image product-image relative"
        @mouseenter="handleMouseEnter"
        @mouseleave="handleMouseLeave">
        <div class="product-image-container relative overflow-hidden">
          <template v-if="productImages.length > 0">
            <div 
              v-for="(image, index) in productImages" 
              :key="index"
              class="product-image-wrapper"
              :class="{ 'opacity-100': currentImageIndex === index, 'opacity-0': currentImageIndex !== index }">
      <responsive-image
                :is-lazy-load="isLazyLoad && index === 0"
                :src="image.src || image.url"
        :base-width="468"
                :base-height="468 / (image.aspect_ratio || 1)"
        :sizes="imgSizes"
                :alt="image.alt || product.title"
                class="w-full h-full"
      ></responsive-image>
            </div>
          </template>
          <template v-else>
            {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
          </template>
        </div>
      <span v-if="isSale" class="product-badge product-badge--sale">{{ 'products.product.on_sale' | t }}</span>
      </div>
      <div 
        v-if="productImages.length > 1" 
        class="product-image-dots">
        <button
          v-for="(image, index) in productImages"
          :key="index"
          type="button"
          class="product-image-dot"
          :class="{ 'bg-white': currentImageIndex === index }"
          @mouseenter="handleDotHover(index)"
          @mouseleave="handleDotLeave"
          :aria-label="'Image ' + (index + 1)"
        ></button>
      </div>
    </div>

    <div v-if="productSku" class="text-center mb-2">
      <span class="text-sm text-black font-medium">
        ${ productSku }
      </span>
    </div>
    <h3 class="h5 text-center" v-html="product.title"></h3>
    <div class="text-center">
    <span class="price" :class="{ 'price--sale': isSale }">${ product.price | currencyFromCents }</span>
    <s v-if="isSale" class="price price--old">${ product.compare_at_price | currencyFromCents }</s>
    </div>
  </a>

  <div v-if="showQuantitySelector || showStockStatus" class="bundle-product-actions-wrapper mt-3 flex items-center gap-3">
    <div v-if="showQuantitySelector" class="bundle-product-actions">
      <quantity-field
        :value="quantityValue || customQuantity || quantity"
        @update-quantity="onQuantityUpdate || (value => quantity = value)"
      />
    </div>
    <div v-if="showStockStatus" class="stock-status flex items-center gap-2">
      <svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
      </svg>
      <span class="text-sm text-gray-700">In Stock <span class="text-gray-500">(Online)</span></span>
    </div>
  </div>

  <form @submit.prevent="handleAddToCart" class="hidden lg:block mt-3">
    <input
      name="id"
      :value="currentVariant ? currentVariant.id : product.variants[0].id"
      type="hidden">

    <template v-if="productOptions.length && !product.has_only_default_variant">
      <div class="field option" v-for="(option, index) in productOptions">
        <label
          :for="'option' + option.position"
          v-html="option.name"
          class="sr-only"></label>
        <select
          :id="product.id + 'option' + option.position"
          :name="'options[' + option.name + ']'"
          v-model="selectedOptions[index]"
          @change="updateVariant">
          <option value="">Select ${ option.name }...</option>
          <option
            v-for="value in option.values"
            :value="value"
            v-html="value"></option>
        </select>
      </div>
    </template>
    <button-spinner
      :is-loading="isAddingToCart"
      class="button button--primary w-full uppercase font-bold"
      :disabled="!currentVariant || !currentVariant.available">
      <span v-if="!currentVariant || currentVariant.available">{{ 'products.product.add_to_cart' | t }}</span>
      <span v-else>{{ 'products.product.sold_out' | t }}</span>
    </button-spinner>
  </form>
</div>